---
title: "setTimeout的细节"
date: 2022-06-27T22:32:58+08:00
tags: ["JS","BOM","前端"]
categories: ["JS"]
---

# setTimeout的细节

很多初学者（<del>包括我</del>)在首次接触到`setTimeout`定时器的概念时都容易被它的含义弄错，它的含义解释起来很简单：”当为定时器提供的时间片到期时，执行为它提供的函数“，但是却容易被误用，这里举个常见的面试题的例子：

> 以下的输出结果是什么？

```js
setTimeout(()=>{
    console.log("a")
},1000);

setTimeout(()=>{
    console.log("b")
},1000);

setTimeout(()=>{
    console.log("c")
},1000);
```

初学者同学可能会认为结果是一秒后输出结果 a ，然后等待一秒后再输出 b ，然后再等待一秒后输出 c 。但是实际并不是这样的，实际上的输出是，等待一秒，然后顺序输出 a 、 b 、 c 。我们需要搞明白`setTimeout`本身也是一个方法，在浏览器环境中这个方法是由`window`对象提供的，在我们显示地调用方法时它实际上已经执行了，也就是说`setTimeout`本质上与`console.log`并没有什么区别，只不过`setTimeout`会暂时性地把传给它的函数给“隐藏”起来，等到传的时间到了，“隐藏”的函数才会被“暴露”出来。

那么 setTimeout(()=>{console.log("a")},1000) 的真实含义应当是：setTimeout 在调用时首先开始进行一个定时，当时间片被消耗完的时候去执行`console.log("a")`，上述的三个定时器几乎是同时进行一个定时操作的，然后由于它们的时间片一致，等到它们的时间片几乎同时被消耗完毕，它们就会按顺序输出，之所以会按顺序输出，是因为先执行的是 setTimeout(()=>{ console.log("a")},1000) 然后是 b ，然后是 c 。

## 同步异步的疑问

可能会有小伙伴有疑问：`setTimeout `不是异步的吗，为什么我说的还是像同步一样，这里我们要搞明白什么叫同步异步，正常的一个函数我们希望它在被调用时就能立即被执行，而不是需要等一个“契机”才能发生这样可以被看成是同步的，同步操作往往是按顺序执行的，像是排队一样，并不会出现插队情况，比如常用的`console.log`；如果使用`while`进行一个死循环操作，它也是同步的，在它之后的函数不可能会在这个“死循环”完成之前就能被执行。但是还有一些函数我们并没有办法完全知道它什么时候能执行完，比如说浏览器去请求服务器的图片资源，如果图片资源过于庞大，难道要让网站等到图片加载完毕才进行渲染吗？所以它不能做成异步的，独立于正常的“排队”操作之外，等到需要它已经好了，这个时候就能被执行了，异步操作更像是一个 VIP 。

再回到开头看那三个定时器，定时器里的函数是异步的，必须要等到时间片消耗完，但是`setTimeout`自身更像是特殊的同步，它会被按顺序执行，只不过它的执行结果是去消耗时间片然后执行回调函数，需要等到一定契机才能被触发，是异步的行为，由于异步的性质并不会阻塞后面的函数执行。

这里浅说以下同步异步，这里还涉及到一个事件轮询机制 Event Loop，后面有机会再细说。